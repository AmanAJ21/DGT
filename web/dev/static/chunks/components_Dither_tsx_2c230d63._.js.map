{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/DGT/components/Dither.tsx"],"sourcesContent":["\"use client\"\r\nimport { useEffect, useRef, useState } from 'react';\r\nimport { Renderer, Program, Mesh, Color, Triangle } from 'ogl';\r\nimport '@/public/css/Dither.css';\r\n\r\nconst VERT = `#version 300 es\r\nin vec2 position;\r\nvoid main() {\r\n  gl_Position = vec4(position, 0.0, 1.0);\r\n}\r\n`;\r\n\r\nconst FRAG = `#version 300 es\r\nprecision highp float;\r\n\r\nuniform float uTime;\r\nuniform vec3 uColor1;\r\nuniform vec3 uColor2;\r\nuniform vec2 uResolution;\r\nuniform float uScale;\r\nuniform float uSpeed;\r\n\r\nout vec4 fragColor;\r\n\r\nfloat hash(vec2 p) {\r\n  return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453123);\r\n}\r\n\r\nfloat noise(vec2 p) {\r\n  vec2 i = floor(p);\r\n  vec2 f = fract(p);\r\n  f = f * f * (3.0 - 2.0 * f);\r\n  \r\n  float a = hash(i);\r\n  float b = hash(i + vec2(1.0, 0.0));\r\n  float c = hash(i + vec2(0.0, 1.0));\r\n  float d = hash(i + vec2(1.0, 1.0));\r\n  \r\n  return mix(mix(a, b, f.x), mix(c, d, f.x), f.y);\r\n}\r\n\r\nmat2 rotate2d(float angle) {\r\n  return mat2(cos(angle), -sin(angle), sin(angle), cos(angle));\r\n}\r\n\r\nvoid main() {\r\n  vec2 uv = gl_FragCoord.xy / uResolution;\r\n  vec2 pos = uv * uScale;\r\n  \r\n  float t = uTime * uSpeed;\r\n  pos = rotate2d(t * 0.1) * pos;\r\n  float n = noise(pos + t);\r\n  n += 0.5 * noise(pos * 2.0 - t * 0.5);\r\n  n += 0.25 * noise(pos * 4.0 + t * 0.3);\r\n  n /= 1.75;\r\n  \r\n  vec2 ditherPos = gl_FragCoord.xy * 0.5;\r\n  float dither = hash(ditherPos) * 0.15;\r\n  \r\n  float threshold = n + dither;\r\n  vec3 color = mix(uColor1, uColor2, smoothstep(0.3, 0.7, threshold));\r\n  \r\n  vec2 center = uv - 0.5;\r\n  float vignette = 1.0 - dot(center, center) * 0.8;\r\n  \r\n  fragColor = vec4(color * vignette, 0.6);\r\n}\r\n`;\r\n\r\ninterface DitherProps {\r\n  color1?: string;\r\n  color2?: string;\r\n  scale?: number;\r\n  speed?: number;\r\n}\r\n\r\nexport default function Dither(props: DitherProps) {\r\n  const { \r\n    color1 = '#3A29FF', \r\n    color2 = '#FF94B4', \r\n    scale = 3.0,\r\n    speed = 0.5 \r\n  } = props;\r\n  \r\n  const propsRef = useRef<DitherProps>(props);\r\n  propsRef.current = props;\r\n  const ctnDom = useRef<HTMLDivElement>(null);\r\n  const [isMobile, setIsMobile] = useState(false);\r\n  const [isVisible, setIsVisible] = useState(true);\r\n\r\n  // Detect mobile and visibility for performance optimization\r\n  useEffect(() => {\r\n    const checkMobile = () => {\r\n      setIsMobile(window.innerWidth < 768);\r\n    };\r\n    \r\n    checkMobile();\r\n    window.addEventListener('resize', checkMobile);\r\n    \r\n    // Pause animation when tab is not visible\r\n    const handleVisibilityChange = () => {\r\n      setIsVisible(!document.hidden);\r\n    };\r\n    \r\n    document.addEventListener('visibilitychange', handleVisibilityChange);\r\n    \r\n    return () => {\r\n      window.removeEventListener('resize', checkMobile);\r\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const ctn = ctnDom.current;\r\n    if (!ctn) return;\r\n\r\n    // Performance optimization: reduce quality on mobile\r\n    const pixelRatio = isMobile ? Math.min(window.devicePixelRatio, 1.5) : window.devicePixelRatio;\r\n    \r\n    const renderer = new Renderer({\r\n      alpha: true,\r\n      premultipliedAlpha: true,\r\n      antialias: !isMobile, // Disable antialiasing on mobile for performance\r\n      dpr: pixelRatio\r\n    });\r\n    const gl = renderer.gl;\r\n    gl.clearColor(0, 0, 0, 0);\r\n    gl.enable(gl.BLEND);\r\n    gl.blendFunc(gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\r\n    gl.canvas.style.backgroundColor = 'transparent';\r\n\r\n    let program: Program | undefined;\r\n\r\n    function resize() {\r\n      if (!ctn) return;\r\n      const width = ctn.offsetWidth;\r\n      const height = ctn.offsetHeight;\r\n      renderer.setSize(width, height);\r\n      if (program) {\r\n        program.uniforms.uResolution.value = [width, height];\r\n      }\r\n    }\r\n    window.addEventListener('resize', resize);\r\n\r\n    const geometry = new Triangle(gl);\r\n    if (geometry.attributes.uv) {\r\n      delete geometry.attributes.uv;\r\n    }\r\n\r\n    // Cache Color objects to avoid creating new ones every frame\r\n    const c1 = new Color(color1);\r\n    const c2 = new Color(color2);\r\n    let cachedColor1 = color1;\r\n    let cachedColor2 = color2;\r\n\r\n    program = new Program(gl, {\r\n      vertex: VERT,\r\n      fragment: FRAG,\r\n      uniforms: {\r\n        uTime: { value: 0 },\r\n        uColor1: { value: [c1.r, c1.g, c1.b] },\r\n        uColor2: { value: [c2.r, c2.g, c2.b] },\r\n        uResolution: { value: [ctn.offsetWidth, ctn.offsetHeight] },\r\n        uScale: { value: scale },\r\n        uSpeed: { value: speed }\r\n      }\r\n    });\r\n\r\n    const mesh = new Mesh(gl, { geometry, program });\r\n    ctn.appendChild(gl.canvas);\r\n\r\n    // Frame rate limiting for performance\r\n    const maxFPS = isMobile ? 30 : 60;\r\n    const frameTime = 1000 / maxFPS;\r\n    let lastFrameTime = 0;\r\n    let animateId = 0;\r\n    \r\n    const update = (t: number) => {\r\n      animateId = requestAnimationFrame(update);\r\n      \r\n      // Skip frame if not enough time has passed or tab is not visible\r\n      if (!isVisible || (t - lastFrameTime < frameTime)) {\r\n        return;\r\n      }\r\n      lastFrameTime = t;\r\n      \r\n      if (program) {\r\n        program.uniforms.uTime.value = t * 0.001;\r\n        \r\n        const currentProps = propsRef.current;\r\n        \r\n        // Only update colors if they changed (avoid creating new Color objects)\r\n        if (currentProps.color1 !== cachedColor1) {\r\n          cachedColor1 = currentProps.color1 ?? color1;\r\n          const newC1 = new Color(cachedColor1);\r\n          program.uniforms.uColor1.value = [newC1.r, newC1.g, newC1.b];\r\n        }\r\n        \r\n        if (currentProps.color2 !== cachedColor2) {\r\n          cachedColor2 = currentProps.color2 ?? color2;\r\n          const newC2 = new Color(cachedColor2);\r\n          program.uniforms.uColor2.value = [newC2.r, newC2.g, newC2.b];\r\n        }\r\n        \r\n        program.uniforms.uScale.value = currentProps.scale ?? scale;\r\n        program.uniforms.uSpeed.value = currentProps.speed ?? speed;\r\n        \r\n        renderer.render({ scene: mesh });\r\n      }\r\n    };\r\n    \r\n    if (isVisible) {\r\n      animateId = requestAnimationFrame(update);\r\n    }\r\n\r\n    resize();\r\n\r\n    return () => {\r\n      cancelAnimationFrame(animateId);\r\n      window.removeEventListener('resize', resize);\r\n      if (ctn && gl.canvas.parentNode === ctn) {\r\n        ctn.removeChild(gl.canvas);\r\n      }\r\n      gl.getExtension('WEBGL_lose_context')?.loseContext();\r\n    };\r\n  }, [color1, color2, scale, speed, isMobile, isVisible]);\r\n\r\n  return <div ref={ctnDom} className=\"dither-container\" />;\r\n}\r\n"],"names":[],"mappings":"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"}}]
}